# üåü Sihatod: Content-Addressable Storage —Å mTLS Protected Layer

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —É—Ä–æ–≤–Ω—è Enterprise

–í —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω **–£—Ä–æ–≤–µ–Ω—å 1: –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**. –î–æ—Å—Ç—É–ø –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É –∑–∞—â–∏—â–µ–Ω –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–º TLS (mTLS). –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ:

1. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ –≤–∞—à–µ–º—É Redis:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ Root CA —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —Ü–µ–ø–æ—á–∫–∏ –¥–æ–≤–µ—Ä–∏—è (SKI/AKI).
2. **Redis –¥–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ –≤–∞—à–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º `CLIENT_AUTH`.
3. **–ó–∞—â–∏—Ç–∞ –æ—Ç MITM:** –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω —Ö–æ—Å—Ç–æ–≤ (hostname) –∏ —Ü–µ–ø–æ—á–µ–∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –≤ Python 3.14+.

**–£—Ä–æ–≤–µ–Ω—å 2: FastAPI**

1. **Strict Mode**: –¢–µ–ø–µ—Ä—å Sihatod –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ ¬´—á–∏—Å—Ç—ã–µ¬ª —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö. –ù–∏–∫–∞–∫–æ–≥–æ –º—É—Å–æ—Ä–∞.
2. **Rate Limiting**: –ë–∞–∑–∞ –∑–∞—â–∏—â–µ–Ω–∞ –æ—Ç —Å–ø–∞–º–∞ –∏ –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
3. **Security Middleware**: –ó–∞–≥–æ–ª–æ–≤–∫–∏ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω—ã, –±—Ä–∞—É–∑–µ—Ä—ã –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* **Content-Addressable Storage (CAS):** –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∞–¥—Ä–µ—Å–∞—Ü–∏—è —á–µ—Ä–µ–∑ SHA256-—Ö–µ—à.
* **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:** –ò–¥–µ–Ω—Ç–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –∏ –≤—Å–µ–≥–¥–∞ –∏–º–µ—é—Ç –æ–¥–∏–Ω –∞–¥—Ä–µ—Å.
* **mTLS –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ:** –í–µ—Å—å —Ç—Ä–∞—Ñ–∏–∫ –º–µ–∂–¥—É FastAPI –∏ Redis –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω.

## üì¶ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ (—Å —É—á–µ—Ç–æ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –∑–∞–∫—Ä—ã—Ç—ã—Ö –∫–ª—é—á–µ–π (PKI). –°–∫—Ä–∏–ø—Ç `generate_certs.py` —Å–æ–∑–¥–∞—Å—Ç –∫–æ—Ä–Ω–µ–≤–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (CA) –∏ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–ª—è mTLS.

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (cryptography)
pip install cryptography

# –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
python generate_certs.py

```

*–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –ø–∞–ø–∫—É `certs/` —Å —Ñ–∞–π–ª–∞–º–∏ `ca.crt`, `redis.crt` –∏ `redis.key*`.

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –∏ —É–∫–∞–∂–∏—Ç–µ –≤ –Ω–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—ã–π URL –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Ç–æ–∫–æ–ª `rediss://` –¥–ª—è TLS):

```env
REDIS_URL=rediss://default:your_secure_password@redis:6379/0

```

### 3. –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
docker-compose up --build -d

```

*Docker –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–±—Ä–æ—Å–∏—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –≤–∑–∞–∏–º–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.*

## üß™ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –°—Ç–µ–∫

* **Python 3.14+** (—Å—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ SSL/TLS).
* **FastAPI & Redis** (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö).
* **Cryptography** (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö X.509 —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤).

## üõ†Ô∏è –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (PowerShell)

**–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ö–µ—à-–∞–¥—Ä–µ—Å–∞):**

```powershell
Invoke-RestMethod -Method Put -Uri "http://localhost:5001/hash/user_1/account_type?value=checking"

```

**–ß—Ç–µ–Ω–∏–µ –ø–æ –∞–¥—Ä–µ—Å—É:**

```powershell
Invoke-RestMethod -Method Get -Uri "http://localhost:5001/hash/user_1/account_type"

```

---

### üõ°Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—â–∏—Ç—ã (Rate Limiting)

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã (—Ç—Ä–æ—Ç—Ç–ª–∏–Ω–≥–∞) –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ PowerShell —Ü–∏–∫–ª, –ø—Ä–µ–≤—ã—à–∞—é—â–∏–π –ª–∏–º–∏—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, 12 –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ –ª–∏–º–∏—Ç–µ 5):

```powershell
1..12 | ForEach-Object { 
    try { 
        $res = Invoke-RestMethod -Method Put -Uri "http://localhost:5001/hash/test/throttle?value=test_${_}"
        Write-Host "–ó–∞–ø—Ä–æ—Å ${_}: Success (200)" -ForegroundColor Green
    } catch { 
        Write-Host "–ó–∞–ø—Ä–æ—Å ${_}: $($_.Exception.Message)" -ForegroundColor Red
    }
}

```

*–ï—Å–ª–∏ –∑–∞—â–∏—Ç–∞ –∞–∫—Ç–∏–≤–Ω–∞, –∑–∞–ø—Ä–æ—Å—ã —Å 6-–≥–æ –ø–æ 12-–π –±—É–¥—É—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω—ã —Å –æ—à–∏–±–∫–æ–π `(429) Too Many Requests`.*

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT.